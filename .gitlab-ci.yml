cache:
  key: ${CI_COMMIT_REF_SLUG}-${CI_PIPELINE_ID}
  paths:
    - composer.lock
    - vendor/

stages:
  - test

phpunit:
  image: pathmotion/composer-php-7.2:latest
  stage: test
  before_script:
    - composer install
  script:
    - ./vendor/bin/phpunit -c tests/unit/phpunit.xml
  allow_failure: false
  tags:
    - gcp-small-runner-prod
